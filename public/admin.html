<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link type="text/css" rel="stylesheet" href="mystyle.css" />
      <title>관리자 페이지</title>
      <script>
         function showProductOption(form) {
            if (form.style.display == 'block') {
               form.style.display = 'none';
            } else if (form.style.display == 'none') {
               form.style.display = 'block';
            }
         }
      </script>
   </head>
   <body>
      <h3>관리자 페이지</h3>

      <input type="button" value="재고 관리 기능" onclick="showProductOption(stockForm)" />
      <input type="button" value="상품 기능" onclick="showProductOption(productForm)" />
      <form method="post" name="stockForm" target="targetURL" id="stockForm" style="display: none">
         <hr />
         <br />
         <p style="display: flex; justify-content: space-around; width: 400px; margin: auto">
            <span>상품코드</span>
            <input type="text" size="23" name="prodSeq" placeholder="ex) 001" />
         </p>
         <p style="display: flex; justify-content: space-around; width: 400px; margin: auto">
            <span>상품번호</span>
            <input type="text" size="23" name="prodId" placeholder="ex) 20230301001" />
         </p>
         <p style="display: flex; justify-content: space-around; width: 400px; margin: auto">
            <span>재고수량</span><input type="text" size="23" name="prodAmount" placeholder="ex) 1" />
         </p>
         <p style="display: flex; justify-content: space-around; width: 400px; margin: auto">
            <span>&nbsp;원산지&nbsp;&nbsp;</span><input type="text" size="23" name="prodProv" placeholder="ex) CHN" />
         </p>
         <p style="display: flex; justify-content: space-around; width: 400px; margin: auto">
            <span>&nbsp;제조사&nbsp;&nbsp;</span
            ><input type="text" size="23" name="prodManu" placeholder="ex) Edam ent." />
         </p>
         <br />
         <input
            type="button"
            value="재고리스트"
            id="stockListBtn"
            onclick="document.targetURL.location.href='/productStock/list'"
         />
         <input
            type="button"
            id="stockFindBtn"
            value="재고검색"
            onclick="document.targetURL.location.href='/productStock/search?prodSeq='+document.stockForm.prodSeq.value"
         />

         <input type="submit" value="재고추가" class="stockBtn" formaction="/productStock/insert" />
         <input type="submit" value="재고수정" class="stockBtn" formaction="/productStock/update" />
         <input type="submit" value="재고삭제" class="stockBtn" formaction="/productStock/delete" />
      </form>
      <form method="post" name="productForm" target="targetURL" id="productForm" style="display: none">
         <hr />
         <br />
         <p style="display: flex; justify-content: space-around; width: 400px; margin: auto">
            <span>상품번호</span>
            <input type="text" size="23" name="prodId" placeholder="ex) 20230301001" />
         </p>
         <p style="display: flex; justify-content: space-around; width: 400px; margin: auto">
            <span>&nbsp;상품명&nbsp;&nbsp;</span
            ><input type="text" size="23" name="prodName" placeholder="ex) 티셔츠" />
         </p>
         <p style="display: flex; justify-content: space-around; width: 400px; margin: auto">
            <span>상품가격</span><input type="text" size="23" name="prodPrice" placeholder="ex) 15000" />
         </p>
         <p style="display: flex; justify-content: space-around; width: 400px; margin: auto">
            <span>아티스트</span><input type="text" size="23" name="prodArti" placeholder="ex) WOODZ" />
         </p>
         <br />
         <input
            type="button"
            value="상품리스트"
            id="productsBtn"
            onclick="document.targetURL.location.href='/product/list'"
         />
         <input
            type="button"
            id="findBtn"
            value="상품 검색"
            onclick="document.targetURL.location.href='/product/find?prodId='+document.productForm.prodId.value"
         />

         <input type="submit" value="상품추가" class="resBtn" formaction="/product/insert" />
         <input type="submit" value="상품수정" class="resBtn" formaction="/product/update" />
         <input type="submit" value="상품삭제" class="resBtn" formaction="/product/delete" />
      </form>
      <hr />
      <div scolling="no" style="overflow: hidden" id="resultTable">
         <iframe
            src="./productStock/list"
            name="targetURL"
            frameborder="0"
            width="80%"
            style="height: 600px; overflow: auto; overflow: no"
         ></iframe>
      </div>
      <script>
         function productTable(product) {
            const body = document.getElementById('resultTable').children[0].contentWindow.document.body;
            const head = document.getElementById('resultTable').children[0].contentWindow.document.head;

            let heads = [];
            for (let head of product) {
               heads = Object.keys(head);
               break;
            }

            const table = document.createElement('table');
            const thead = document.createElement('thead');
            const tr = document.createElement('tr');
            for (let th of heads) {
               tr.innerHTML += '<th>' + th.toUpperCase() + '</th>';
            }
            // tr.innerHTML = '<th>PRODUCT ID</th><th>PRODUCT NAME</th><th>PRODUCT PRICE</th><th>PRODUCT ARTIST</th>';

            thead.appendChild(tr);
            const tbody = document.createElement('tbody');
            let temp = '';
            for (let prod_row = 0; prod_row < product.length; prod_row++) {
               temp += '<tr>';
               for (let head_row = 0; head_row < heads.length; head_row++) {
                  temp += '<td>' + product[prod_row][heads[head_row]] + '</td>';
               }
               temp += '</tr>';
            }

            tbody.innerHTML = temp;
            table.appendChild(thead);
            table.appendChild(tbody);
            body.innerHTML = '';
            let link = document.createElement('link');
            link.type = 'text/css';
            link.rel = 'stylesheet';
            link.href = '../table.css';
            head.appendChild(link);
            table.style.margin = 'auto';
            body.append(table);
         }

         function drawResultCode(result) {
            const body = document.getElementById('resultTable').children[0].contentWindow.document.body;
            const head = document.getElementById('resultTable').children[0].contentWindow.document.head;

            let heads = Object.keys(result);

            const table = document.createElement('table');
            const thead = document.createElement('thead');
            const tr = document.createElement('tr');

            for (let th of heads) {
               tr.innerHTML += '<th>' + th.toUpperCase() + '</th>';
            }

            thead.appendChild(tr);
            const tbody = document.createElement('tbody');
            let temp = '';
            temp += '<tr>';
            for (let head_row = 0; head_row < heads.length; head_row++) {
               temp += '<td>' + result[heads[head_row]] + '</td>';
            }
            temp += '</tr>';

            tbody.innerHTML = temp;
            table.appendChild(thead);
            table.appendChild(tbody);
            body.innerHTML = '';
            let link = document.createElement('link');
            link.type = 'text/css';
            link.rel = 'stylesheet';
            link.href = '../table.css';
            head.appendChild(link);
            table.style.margin = 'auto';
            body.append(table);
         }

         window.onload = () => {
            setTimeout(() => {
               let result = JSON.parse(
                  document.getElementById('resultTable').children[0].contentWindow.document.body.textContent,
               );
               let productStock = result.productStock;
               if (result.ok) productTable(productStock);
               else drawResultCode(result);
            }, 100);
            document.getElementById('stockListBtn').addEventListener('click', () => {
               setTimeout(() => {
                  let result = JSON.parse(
                     document.getElementById('resultTable').children[0].contentWindow.document.body.textContent,
                  );
                  let productStock = result.productStock;
                  if (result.ok) productTable(productStock);
                  else drawResultCode(result);
               }, 500);
            });
            document.getElementById('stockFindBtn').addEventListener('click', () => {
               setTimeout(() => {
                  let result = JSON.parse(
                     document.getElementById('resultTable').children[0].contentWindow.document.body.textContent,
                  );
                  let productStock = result;
                  if (productStock.ok == 'false') drawResultCode(result);
                  else productTable(productStock);
               }, 500);
            });
            let sts = document.getElementsByClassName('stockBtn');
            let sts_arr = Array.from(sts);
            sts_arr.forEach(sts => {
               sts.addEventListener('click', () => {
                  setTimeout(() => {
                     let result = JSON.parse(
                        document.getElementById('resultTable').children[0].contentWindow.document.body.textContent,
                     );
                     if (result.ok) drawResultCode(result);
                     else drawResultCode(result);
                  }, 500);
               });
            });
            document.getElementById('productsBtn').addEventListener('click', () => {
               setTimeout(() => {
                  let result = JSON.parse(
                     document.getElementById('resultTable').children[0].contentWindow.document.body.textContent,
                  );
                  let product = result.product;
                  if (result.ok) productTable(product);
                  else drawResultCode(result);
               }, 500);
            });
            document.getElementById('findBtn').addEventListener('click', () => {
               setTimeout(() => {
                  let result = JSON.parse(
                     document.getElementById('resultTable').children[0].contentWindow.document.body.textContent,
                  );
                  let product = result.product;
                  // console.log(productStock[0]);
                  if (result.ok) productTable(product);
                  else drawResultCode(result);
               }, 500);
            });
            let bts = document.getElementsByClassName('resBtn');
            let bts_arr = Array.from(bts);
            bts_arr.forEach(bts => {
               bts.addEventListener('click', () => {
                  setTimeout(() => {
                     let result = JSON.parse(
                        document.getElementById('resultTable').children[0].contentWindow.document.body.textContent,
                     );
                     if (result.ok) drawResultCode(result);
                     else drawResultCode(result);
                  }, 500);
               });
            });
         };
      </script>
   </body>
</html>
